{
  "openapi": "3.0.3",
  "info": {
    "title": "safehaven",
    "description": "",
    "license": {
      "name": ""
    },
    "version": "0.1.0"
  },
  "paths": {
    "/api/admin/access_tokens": {
      "get": {
        "tags": [
          "admin::access_tokens"
        ],
        "operationId": "list",
        "responses": {
          "200": {
            "description": "List of access tokens",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/AccessToken"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "admin::access_tokens"
        ],
        "operationId": "new",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewOrUpdateAccessToken"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "List of access tokens",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AccessToken"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/access_tokens/{id}": {
      "get": {
        "tags": [
          "admin::access_tokens"
        ],
        "operationId": "get",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Access token identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Access token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AccessToken"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "admin::access_tokens"
        ],
        "operationId": "update",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Access token identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewOrUpdateAccessToken"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Access token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AccessToken"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "admin::access_tokens"
        ],
        "operationId": "delete",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Access token identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Deletion successful"
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/categories": {
      "get": {
        "tags": [
          "admin::categories"
        ],
        "operationId": "list",
        "responses": {
          "200": {
            "description": "List of categories",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Category"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "admin::categories"
        ],
        "operationId": "new",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewCategory"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Category created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Category"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/categories/{id}": {
      "get": {
        "tags": [
          "admin::categories"
        ],
        "operationId": "get",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Category identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Category details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Category"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "admin::categories"
        ],
        "operationId": "update",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Category identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCategory"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Category updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Category"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "admin::categories"
        ],
        "operationId": "delete",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Category identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Category deletion successful"
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/comments": {
      "post": {
        "tags": [
          "admin::comments"
        ],
        "operationId": "new",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewComment"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Comment created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Comment"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/comments/pending": {
      "get": {
        "tags": [
          "admin::comments"
        ],
        "operationId": "pending",
        "responses": {
          "200": {
            "description": "List of pending comments",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ListedComment"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/comments/{id}": {
      "get": {
        "tags": [
          "admin::comments"
        ],
        "operationId": "get",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Comment identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Comment details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Comment"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "admin::comments"
        ],
        "operationId": "update",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Comment identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateComment"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Comment updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Comment"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "admin::comments"
        ],
        "operationId": "delete",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Comment identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Comment deleted successfully"
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/entities": {
      "post": {
        "tags": [
          "admin::entities"
        ],
        "operationId": "new",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewEntity"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Entity created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Entity"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/entities/pending": {
      "get": {
        "tags": [
          "admin::entities"
        ],
        "operationId": "pending",
        "responses": {
          "200": {
            "description": "List of pending entities",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ListedEntity"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/entities/search": {
      "get": {
        "tags": [
          "admin::entities"
        ],
        "operationId": "search",
        "parameters": [
          {
            "name": "search",
            "in": "query",
            "description": "Search query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "Current page (default: 1)",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "page_size",
            "in": "query",
            "description": "Number of items per page (default: 20)",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Search results for entities",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ListedEntity"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/entities/{id}": {
      "get": {
        "tags": [
          "admin::entities"
        ],
        "operationId": "get",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Entity identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Entity details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Entity"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "admin::entities"
        ],
        "operationId": "update",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Entity identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateEntity"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Entity updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Entity"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "admin::entities"
        ],
        "operationId": "delete",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Entity identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Entity deleted successfully"
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/entities/{id}/comments": {
      "get": {
        "tags": [
          "admin::entities"
        ],
        "operationId": "get_comments",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Entity identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of comments for the entity",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ListedComment"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/entities/{parent_id}/parent/{child_id}": {
      "post": {
        "tags": [
          "admin::entities"
        ],
        "operationId": "register_parent",
        "parameters": [
          {
            "name": "parent_id",
            "in": "path",
            "description": "Parent entity identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "child_id",
            "in": "path",
            "description": "Child entity identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Parent entity registered successfully"
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "admin::entities"
        ],
        "operationId": "remove_parent",
        "parameters": [
          {
            "name": "parent_id",
            "in": "path",
            "description": "Parent entity identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "child_id",
            "in": "path",
            "description": "Child entity identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Parent-child relationship removed successfully"
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Relationship not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/families": {
      "get": {
        "tags": [
          "admin::families"
        ],
        "operationId": "list",
        "responses": {
          "200": {
            "description": "List of families",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Family"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "admin::families"
        ],
        "operationId": "new",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewOrUpdateFamily"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Family created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Family"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/families/{id}": {
      "get": {
        "tags": [
          "admin::families"
        ],
        "operationId": "get",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Family identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Family details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Family"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "admin::families"
        ],
        "operationId": "update",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Family identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewOrUpdateFamily"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Family updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Family"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "admin::families"
        ],
        "operationId": "delete",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Family identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Family deleted successfully"
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/login": {
      "post": {
        "tags": [
          "admin"
        ],
        "operationId": "login",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Login",
            "headers": {
              "Set-Cookie": {
                "schema": {
                  "$ref": "#/components/schemas/CookieJar"
                },
                "description": "Cookie jar with auth cookie inside"
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginResponse"
                }
              }
            }
          },
          "404": {
            "description": "User or password not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/tags": {
      "get": {
        "tags": [
          "admin::tags"
        ],
        "operationId": "list",
        "responses": {
          "200": {
            "description": "List of tags",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Tag"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "admin::tags"
        ],
        "operationId": "new",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewOrUpdateTag"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Tag created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Tag"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/tags/{id}": {
      "get": {
        "tags": [
          "admin::tags"
        ],
        "operationId": "get",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Tag identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Tag details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Tag"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "admin::tags"
        ],
        "operationId": "update",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Tag identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewOrUpdateTag"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Tag updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Tag"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "admin::tags"
        ],
        "operationId": "delete",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Tag identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Tag deleted successfully"
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/users": {
      "get": {
        "tags": [
          "admin::users"
        ],
        "operationId": "list",
        "responses": {
          "200": {
            "description": "List of users",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/User"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "admin::users"
        ],
        "operationId": "new",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewUser"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "User",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/users/self/password": {
      "put": {
        "tags": [
          "admin::users"
        ],
        "operationId": "change_self_password",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChangePassword"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "User",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/users/{id}": {
      "get": {
        "tags": [
          "admin::users"
        ],
        "operationId": "get",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "User identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "admin::users"
        ],
        "operationId": "delete",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "User identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Deletion successful"
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/users/{id}/password": {
      "put": {
        "tags": [
          "admin::users"
        ],
        "operationId": "change_password",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "User identifier",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChangePassword"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "User",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/bootstrap/{token}": {
      "get": {
        "tags": [
          "root"
        ],
        "operationId": "boostrap",
        "parameters": [
          {
            "name": "token",
            "in": "path",
            "description": "Access token",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "referrer",
            "in": "query",
            "description": "The referrer URL to register the visit",
            "required": false,
            "schema": {
              "type": "string",
              "nullable": true
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Bootstraping data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BootstrapResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/map/comments": {
      "post": {
        "tags": [
          "map"
        ],
        "operationId": "new_comment",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewEntityRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Comment",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Comment"
                }
              }
            }
          },
          "401": {
            "description": "Invalid token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/map/entities": {
      "post": {
        "tags": [
          "map"
        ],
        "operationId": "new_entity",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewEntityRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Entity"
                }
              }
            }
          },
          "401": {
            "description": "Invalid token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/map/entities/{id}": {
      "get": {
        "tags": [
          "map"
        ],
        "operationId": "fetch_entity",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FetchedEntity"
                }
              }
            }
          },
          "401": {
            "description": "Invalid token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Entity not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/map/search": {
      "post": {
        "tags": [
          "map"
        ],
        "operationId": "search_request",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "List of entities",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/CachedEntity"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/map/view": {
      "post": {
        "tags": [
          "map"
        ],
        "operationId": "view_request",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ViewRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "List of entities",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EntitiesAndClusters"
                }
              }
            }
          },
          "401": {
            "description": "Invalid token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/options": {
      "get": {
        "tags": [
          "options"
        ],
        "operationId": "get",
        "responses": {
          "200": {
            "description": "Option map",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SafeHavenOptions"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/options/{name}": {
      "put": {
        "tags": [
          "options"
        ],
        "operationId": "update",
        "parameters": [
          {
            "name": "name",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConfigurationOption"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Option map",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SafeHavenOptions"
                }
              }
            }
          },
          "401": {
            "description": "Invalid permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/status": {
      "get": {
        "tags": [
          "root"
        ],
        "operationId": "status",
        "responses": {
          "200": {
            "description": "Status check and pre init",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatusResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AccessToken": {
        "type": "object",
        "required": [
          "id",
          "token",
          "permissions",
          "active"
        ],
        "properties": {
          "active": {
            "type": "boolean"
          },
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "permissions": {
            "$ref": "#/components/schemas/Json"
          },
          "token": {
            "type": "string"
          }
        }
      },
      "BootstrapResponse": {
        "type": "object",
        "required": [
          "signed_token",
          "families",
          "categories",
          "tags",
          "cartography_init_config"
        ],
        "properties": {
          "cartography_init_config": {
            "$ref": "#/components/schemas/CartographyInitConfig"
          },
          "categories": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Category"
            }
          },
          "families": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Family"
            }
          },
          "signed_token": {
            "type": "string"
          },
          "tags": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Tag"
            }
          }
        }
      },
      "CachedEntity": {
        "type": "object",
        "required": [
          "id",
          "entity_id",
          "category_id",
          "categories_ids",
          "tags_ids",
          "family_id",
          "display_name",
          "web_mercator_x",
          "web_mercator_y",
          "plain_text_location"
        ],
        "properties": {
          "categories_ids": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uuid"
            }
          },
          "category_id": {
            "type": "string",
            "format": "uuid"
          },
          "display_name": {
            "type": "string"
          },
          "entity_id": {
            "type": "string",
            "format": "uuid"
          },
          "family_id": {
            "type": "string",
            "format": "uuid"
          },
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "plain_text_location": {
            "type": "string"
          },
          "tags_ids": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uuid"
            }
          },
          "web_mercator_x": {
            "type": "number",
            "format": "double"
          },
          "web_mercator_y": {
            "type": "number",
            "format": "double"
          }
        }
      },
      "CartographyClusterConfig": {
        "type": "object",
        "description": "Entity clusterization parameters",
        "properties": {
          "characteristic_distance": {
            "type": "number",
            "format": "double",
            "description": "Characteristic distance for clusterization",
            "default": 5.0
          },
          "declustering_speed": {
            "type": "number",
            "format": "double",
            "description": "Declustering speed (most of the time between 1.5 and 2, defaults to 1.65)",
            "default": 1.65
          },
          "minimal_cluster_size": {
            "type": "integer",
            "format": "int32",
            "description": "Minimal entity count for forming a cluster",
            "default": 6
          }
        }
      },
      "CartographyInitConfig": {
        "type": "object",
        "description": "Displayed map initialization parameters",
        "required": [
          "center_lat",
          "center_lng",
          "zoom"
        ],
        "properties": {
          "center_lat": {
            "type": "number",
            "format": "double",
            "description": "Latitude of the map center (WGS84)"
          },
          "center_lng": {
            "type": "number",
            "format": "double",
            "description": "Longitude of the map center (WGS84)"
          },
          "zoom": {
            "type": "integer",
            "format": "int32",
            "description": "Zoom level of the map (from 2 to 20)",
            "minimum": 0
          }
        }
      },
      "Category": {
        "type": "object",
        "required": [
          "id",
          "title",
          "family_id",
          "default_status",
          "fill_color",
          "border_color"
        ],
        "properties": {
          "border_color": {
            "type": "string"
          },
          "default_status": {
            "type": "boolean"
          },
          "family_id": {
            "type": "string",
            "format": "uuid"
          },
          "fill_color": {
            "type": "string"
          },
          "icon": {
            "type": "string",
            "nullable": true
          },
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "title": {
            "type": "string"
          }
        }
      },
      "ChangePassword": {
        "type": "object",
        "required": [
          "password"
        ],
        "properties": {
          "password": {
            "type": "string"
          }
        }
      },
      "Cluster": {
        "type": "object",
        "required": [
          "id",
          "center_x",
          "center_y",
          "count"
        ],
        "properties": {
          "center_x": {
            "type": "number",
            "format": "double"
          },
          "center_y": {
            "type": "number",
            "format": "double"
          },
          "count": {
            "type": "integer",
            "format": "int32"
          },
          "id": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          }
        }
      },
      "Comment": {
        "type": "object",
        "required": [
          "id",
          "entity_id",
          "author",
          "text",
          "data",
          "created_at",
          "updated_at"
        ],
        "properties": {
          "author": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "data": {},
          "entity_id": {
            "type": "string",
            "format": "uuid"
          },
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "moderated_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "moderated_by": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "text": {
            "type": "string"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ConfigurationOption": {
        "oneOf": [
          {
            "type": "object",
            "required": [
              "General"
            ],
            "properties": {
              "General": {
                "$ref": "#/components/schemas/GeneralOptions"
              }
            }
          },
          {
            "type": "object",
            "required": [
              "SafeMode"
            ],
            "properties": {
              "SafeMode": {
                "$ref": "#/components/schemas/SafeModeConfig"
              }
            }
          },
          {
            "type": "object",
            "required": [
              "CartographyInit"
            ],
            "properties": {
              "CartographyInit": {
                "$ref": "#/components/schemas/CartographyInitConfig"
              }
            }
          },
          {
            "type": "object",
            "required": [
              "CartographyCluster"
            ],
            "properties": {
              "CartographyCluster": {
                "$ref": "#/components/schemas/CartographyClusterConfig"
              }
            }
          }
        ]
      },
      "EntitiesAndClusters": {
        "type": "object",
        "required": [
          "entities",
          "clusters"
        ],
        "properties": {
          "clusters": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Cluster"
            }
          },
          "entities": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CachedEntity"
            }
          }
        }
      },
      "Entity": {
        "type": "object",
        "required": [
          "id",
          "display_name",
          "category_id",
          "locations",
          "data",
          "hide_from_map",
          "created_at",
          "updated_at"
        ],
        "properties": {
          "category_id": {
            "type": "string",
            "format": "uuid"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "data": {},
          "display_name": {
            "type": "string"
          },
          "hide_from_map": {
            "type": "boolean"
          },
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "last_update_by": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "locations": {
            "$ref": "#/components/schemas/Json"
          },
          "moderated_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "moderation_notes": {
            "type": "string",
            "nullable": true
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "required": [
          "error_code"
        ],
        "properties": {
          "details": {
            "type": "string",
            "nullable": true
          },
          "error_code": {
            "type": "string"
          }
        }
      },
      "Family": {
        "type": "object",
        "required": [
          "id",
          "title",
          "entity_form",
          "comment_form"
        ],
        "properties": {
          "comment_form": {
            "$ref": "#/components/schemas/Json"
          },
          "entity_form": {
            "$ref": "#/components/schemas/Json"
          },
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "title": {
            "type": "string"
          }
        }
      },
      "FetchedEntity": {
        "type": "object",
        "required": [
          "entity",
          "comments",
          "parents",
          "children"
        ],
        "properties": {
          "children": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ListedEntity"
            }
          },
          "comments": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PublicComment"
            }
          },
          "entity": {
            "$ref": "#/components/schemas/PublicEntity"
          },
          "parents": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ListedEntity"
            }
          }
        }
      },
      "Field": {
        "type": "object",
        "required": [
          "key",
          "display_name",
          "field_type",
          "indexed",
          "mandatory",
          "user_facing",
          "form_page",
          "form_weight",
          "display_weight"
        ],
        "properties": {
          "display_name": {
            "type": "string",
            "description": "The display name is used to show the field in the UI"
          },
          "display_weight": {
            "type": "integer",
            "format": "int32",
            "description": "The weight of the field in the display (when displayed, ordered by weight)",
            "minimum": 0
          },
          "field_type": {
            "$ref": "#/components/schemas/FieldType"
          },
          "field_type_metadata": {
            "description": "Used to store detail about the field that relevent\nonly for the frontend. For instance, if the field is an enum\nuse it to store possible values. If it is a SingleLineText, specify\nif it's an email, a phone number, etc...",
            "nullable": true
          },
          "form_page": {
            "type": "integer",
            "format": "int32",
            "description": "Form page number for the given field",
            "minimum": 0
          },
          "form_weight": {
            "type": "integer",
            "format": "int32",
            "description": "The weight of the field in the form (when displayed, ordered by weight)",
            "minimum": 0
          },
          "help": {
            "type": "string",
            "description": "The help text is used to show additional information about the field in the UI",
            "nullable": true
          },
          "indexed": {
            "type": "boolean",
            "description": "Sets if the field is indexed (used in full text search)"
          },
          "key": {
            "type": "string",
            "description": "The key is used to identify the field in the data object"
          },
          "mandatory": {
            "type": "boolean",
            "description": "Sets if the field is mandatory"
          },
          "user_facing": {
            "type": "boolean",
            "description": "Sets if the field is displayed to the final user"
          }
        }
      },
      "FieldType": {
        "type": "string",
        "enum": [
          "SingleLineText",
          "MultiLineText",
          "Number",
          "Boolean",
          "DiscreteScore",
          "Date",
          "EnumSingleOption",
          "EnumMultiOption",
          "EventList"
        ]
      },
      "Form": {
        "type": "object",
        "required": [
          "title",
          "fields"
        ],
        "properties": {
          "fields": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Field"
            }
          },
          "title": {
            "type": "string"
          }
        }
      },
      "GeneralOptions": {
        "type": "object",
        "properties": {
          "logo_url": {
            "type": "string",
            "default": null,
            "nullable": true
          },
          "subtitle": {
            "type": "string",
            "default": "Carte associative",
            "nullable": true
          },
          "title": {
            "type": "string",
            "default": "SafeHaven"
          }
        }
      },
      "ListedComment": {
        "type": "object",
        "required": [
          "id",
          "entity_id",
          "entity_display_name",
          "entity_category_id",
          "created_at"
        ],
        "properties": {
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "entity_category_id": {
            "type": "string",
            "format": "uuid"
          },
          "entity_display_name": {
            "type": "string"
          },
          "entity_id": {
            "type": "string",
            "format": "uuid"
          },
          "id": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "ListedEntity": {
        "type": "object",
        "required": [
          "id",
          "display_name",
          "category_id",
          "created_at"
        ],
        "properties": {
          "category_id": {
            "type": "string",
            "format": "uuid"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "display_name": {
            "type": "string"
          },
          "id": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": [
          "username",
          "password"
        ],
        "properties": {
          "password": {
            "type": "string"
          },
          "username": {
            "type": "string"
          }
        }
      },
      "LoginResponse": {
        "type": "object",
        "required": [
          "is_admin"
        ],
        "properties": {
          "is_admin": {
            "type": "boolean"
          }
        }
      },
      "NewCategory": {
        "type": "object",
        "required": [
          "title",
          "family_id"
        ],
        "properties": {
          "family_id": {
            "type": "string",
            "format": "uuid"
          },
          "title": {
            "type": "string"
          }
        }
      },
      "NewComment": {
        "type": "object",
        "required": [
          "entity_id",
          "author",
          "text",
          "data"
        ],
        "properties": {
          "author": {
            "type": "string"
          },
          "data": {},
          "entity_id": {
            "type": "string",
            "format": "uuid"
          },
          "text": {
            "type": "string"
          }
        }
      },
      "NewCommentRequest": {
        "type": "object",
        "required": [
          "comment"
        ],
        "properties": {
          "comment": {
            "$ref": "#/components/schemas/NewComment"
          }
        }
      },
      "NewEntity": {
        "type": "object",
        "required": [
          "display_name",
          "category_id",
          "data",
          "last_update_by"
        ],
        "properties": {
          "category_id": {
            "type": "string",
            "format": "uuid"
          },
          "data": {},
          "display_name": {
            "type": "string"
          },
          "last_update_by": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "NewEntityRequest": {
        "type": "object",
        "required": [
          "entity"
        ],
        "properties": {
          "entity": {
            "$ref": "#/components/schemas/NewEntity"
          }
        }
      },
      "NewOrUpdateAccessToken": {
        "type": "object",
        "required": [
          "token",
          "permissions",
          "active"
        ],
        "properties": {
          "active": {
            "type": "boolean"
          },
          "permissions": {
            "$ref": "#/components/schemas/Json"
          },
          "token": {
            "type": "string"
          }
        }
      },
      "NewOrUpdateFamily": {
        "type": "object",
        "required": [
          "title",
          "entity_form",
          "comment_form"
        ],
        "properties": {
          "comment_form": {
            "$ref": "#/components/schemas/Form"
          },
          "entity_form": {
            "$ref": "#/components/schemas/Form"
          },
          "title": {
            "type": "string"
          }
        }
      },
      "NewOrUpdateTag": {
        "type": "object",
        "required": [
          "title",
          "is_filter"
        ],
        "properties": {
          "filter_description": {
            "type": "string",
            "nullable": true
          },
          "is_filter": {
            "type": "boolean"
          },
          "title": {
            "type": "string"
          }
        }
      },
      "NewUser": {
        "type": "object",
        "required": [
          "name",
          "password"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "password": {
            "type": "string"
          }
        }
      },
      "PermissionPolicy": {
        "type": "object",
        "required": [
          "allow_all",
          "allow_list",
          "force_exclude"
        ],
        "properties": {
          "allow_all": {
            "type": "boolean"
          },
          "allow_list": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uuid"
            }
          },
          "force_exclude": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uuid"
            }
          }
        }
      },
      "Permissions": {
        "type": "object",
        "required": [
          "families_policy",
          "categories_policy",
          "tags_policy",
          "can_access_comments"
        ],
        "properties": {
          "can_access_comments": {
            "type": "boolean"
          },
          "categories_policy": {
            "$ref": "#/components/schemas/PermissionPolicy"
          },
          "families_policy": {
            "$ref": "#/components/schemas/PermissionPolicy"
          },
          "tags_policy": {
            "$ref": "#/components/schemas/PermissionPolicy"
          }
        }
      },
      "PublicComment": {
        "type": "object",
        "required": [
          "id",
          "author",
          "text",
          "data",
          "created_at",
          "updated_at"
        ],
        "properties": {
          "author": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "data": {},
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "text": {
            "type": "string"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "PublicEntity": {
        "type": "object",
        "required": [
          "id",
          "category_id",
          "family_id",
          "display_name",
          "locations",
          "data",
          "tags",
          "entity_form",
          "comment_form"
        ],
        "properties": {
          "category_id": {
            "type": "string",
            "format": "uuid"
          },
          "comment_form": {
            "$ref": "#/components/schemas/Json"
          },
          "data": {},
          "display_name": {
            "type": "string"
          },
          "entity_form": {
            "$ref": "#/components/schemas/Json"
          },
          "family_id": {
            "type": "string",
            "format": "uuid"
          },
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "locations": {
            "$ref": "#/components/schemas/Json"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uuid"
            }
          }
        }
      },
      "SafeHavenOptions": {
        "type": "object",
        "required": [
          "general",
          "safe_mode",
          "cartography_init",
          "cartography_cluster"
        ],
        "properties": {
          "cartography_cluster": {
            "$ref": "#/components/schemas/CartographyClusterConfig"
          },
          "cartography_init": {
            "$ref": "#/components/schemas/CartographyInitConfig"
          },
          "general": {
            "$ref": "#/components/schemas/GeneralOptions"
          },
          "safe_mode": {
            "$ref": "#/components/schemas/SafeModeConfig"
          }
        }
      },
      "SafeMode": {
        "type": "object",
        "required": [
          "recaptcha_v3_sitekey",
          "popup_title",
          "popup_message"
        ],
        "properties": {
          "popup_message": {
            "type": "string"
          },
          "popup_title": {
            "type": "string"
          },
          "recaptcha_v3_sitekey": {
            "type": "string"
          }
        }
      },
      "SafeModeConfig": {
        "type": "object",
        "description": "Safe mode configuration, when enabled, the application will require recaptcha validation for\nalmost every action making it harder to spam the application or dump the database content",
        "properties": {
          "enabled": {
            "type": "boolean",
            "description": "Enable safe mode",
            "default": false
          },
          "popup_message": {
            "type": "string",
            "description": "Message of the popup shown for first recaptcha validation",
            "default": null,
            "nullable": true
          },
          "popup_title": {
            "type": "string",
            "description": "Title of the popup shown for first recaptcha validation",
            "default": null,
            "nullable": true
          },
          "recaptcha_v3_secret": {
            "type": "string",
            "description": "Secret key for recaptcha v3",
            "default": ""
          },
          "recaptcha_v3_sitekey": {
            "type": "string",
            "description": "Site key for recaptcha v3",
            "default": ""
          },
          "recaptcha_v3_threshold": {
            "type": "number",
            "format": "double",
            "description": "Threshold for recaptcha v3",
            "default": 0.5
          }
        }
      },
      "SearchRequest": {
        "type": "object",
        "required": [
          "search_query",
          "family_id",
          "page",
          "page_size"
        ],
        "properties": {
          "family_id": {
            "type": "string",
            "format": "uuid"
          },
          "page": {
            "type": "integer",
            "format": "int64"
          },
          "page_size": {
            "type": "integer",
            "format": "int64"
          },
          "search_query": {
            "type": "string"
          }
        }
      },
      "StatusResponse": {
        "type": "object",
        "required": [
          "status",
          "general"
        ],
        "properties": {
          "general": {
            "$ref": "#/components/schemas/GeneralOptions"
          },
          "safe_mode": {
            "allOf": [
              {
                "$ref": "#/components/schemas/SafeMode"
              }
            ],
            "nullable": true
          },
          "status": {
            "type": "string"
          }
        }
      },
      "Tag": {
        "type": "object",
        "required": [
          "id",
          "title",
          "is_filter"
        ],
        "properties": {
          "filter_description": {
            "type": "string",
            "nullable": true
          },
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "is_filter": {
            "type": "boolean"
          },
          "title": {
            "type": "string"
          }
        }
      },
      "UnprocessedLocation": {
        "type": "object",
        "required": [
          "plain_text",
          "lat",
          "long"
        ],
        "properties": {
          "lat": {
            "type": "number",
            "format": "double"
          },
          "long": {
            "type": "number",
            "format": "double"
          },
          "plain_text": {
            "type": "string"
          }
        }
      },
      "UpdateCategory": {
        "type": "object",
        "required": [
          "title",
          "family_id",
          "default_status",
          "fill_color",
          "border_color"
        ],
        "properties": {
          "border_color": {
            "type": "string"
          },
          "default_status": {
            "type": "boolean"
          },
          "family_id": {
            "type": "string",
            "format": "uuid"
          },
          "fill_color": {
            "type": "string"
          },
          "icon": {
            "type": "string",
            "nullable": true
          },
          "title": {
            "type": "string"
          }
        }
      },
      "UpdateComment": {
        "type": "object",
        "required": [
          "entity_id",
          "author",
          "text",
          "data"
        ],
        "properties": {
          "author": {
            "type": "string"
          },
          "data": {},
          "entity_id": {
            "type": "string",
            "format": "uuid"
          },
          "moderated_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "moderated_by": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "text": {
            "type": "string"
          }
        }
      },
      "UpdateEntity": {
        "type": "object",
        "required": [
          "display_name",
          "category_id",
          "data"
        ],
        "properties": {
          "category_id": {
            "type": "string",
            "format": "uuid"
          },
          "data": {},
          "display_name": {
            "type": "string"
          },
          "last_update_by": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "moderation_notes": {
            "type": "string",
            "nullable": true
          }
        }
      },
      "User": {
        "type": "object",
        "required": [
          "id",
          "name",
          "is_admin"
        ],
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "is_admin": {
            "type": "boolean"
          },
          "name": {
            "type": "string"
          }
        }
      },
      "ViewRequest": {
        "type": "object",
        "required": [
          "family_id",
          "xmin",
          "ymin",
          "xmax",
          "ymax",
          "zoom_level"
        ],
        "properties": {
          "family_id": {
            "type": "string",
            "format": "uuid"
          },
          "xmax": {
            "type": "number",
            "format": "double"
          },
          "xmin": {
            "type": "number",
            "format": "double"
          },
          "ymax": {
            "type": "number",
            "format": "double"
          },
          "ymin": {
            "type": "number",
            "format": "double"
          },
          "zoom_level": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          }
        }
      }
    }
  }
}